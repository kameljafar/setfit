
<!DOCTYPE html>
<html lang="ar">
<head>
    <title>Classification Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>
    <style>
        #loader {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          display: none;
        }
      </style>

<div class="container py-4">
    <h3 class="text-center py-3 px-2">Добро пожаловать!</h3>
    <form id="text-form" method="post">

        <div class="form-group">
            <img id="loader" src = "static/loader.gif" style = "width : 30px;height:30px">
            <h4 style="text-align:left"><label for="txt">Enter your text</label></h4>
            <textarea style="font-size: 14pt;text-align: left" class="form-control" rows="3" name="txt" id="txt"></textarea>
            <a class="btn btn-info btn-lg mt-4" onclick="submit_text()">Categories</a>
			<a id="reset-btn" class="btn btn-info btn-lg mt-4" onclick="clear_result()">Reset</a>

        </div>
		    <div id="result-container" style="margin-top:20px;">
        <h4 style="text-align:left"><label for="result">Predicted Categories:</label></h4>

        <h4><textarea style="font-size: 14pt;text-align: left" class="form-control" rows="4" name="result" id="result" readonly></textarea></h4>
    </div>
    <div class="container py-4">


      
      </h4>

    </div>
    </form>



    </div>
       

	</div>

<script>
    function clear_result() {
        document.getElementById("txt").value = "";
        document.getElementById("result").value = "";
        document.getElementById('result-card').innerHTML = `<h4>Result </h4><br><p class="card-text">No results yet.</p>`;
}
</script>
<script>
async function submit_text() {
    const loader = document.getElementById("loader");
    document.getElementById('result').value = "";
    loader.style.display = "block";
    const text = document.getElementById("txt").value;
    let input = document.getElementById("result");
    let resultCard = document.getElementById('result-card');
    if (text.trim() === '') {
        const res = "Please write your text.";
            input.value = res;
        return;
    }
    try{
        // let response = await fetch('https://aihse.event33.ru/predict', {
        let response = await fetch('http://127.0.0.1:8099/predict', {

            method: 'POST',
            body: JSON.stringify({ "texts": text }),
            headers: { 'Content-Type': 'application/json' }
        })
        if (response.status === 200) {
            let data = await response.json();
            let first_cates = data[0].predictions.Профиль_нормы;
			let second_cates = data[0].predictions.Тип_нормы;
            let scorPercentage = (data[0].predictions.score * 100).toFixed(2) + '%';
            if ( true ) 
            {
                const res = `
Профиль нормы : ${first_cates}
Тип нормы : ${second_cates}
score : ${scorPercentage}`;

                            input.value = res;
                // const res = `Профиль нормы : ${first_cates}
                //             Тип нормы : ${second_cates}
                //             score : ${scorPercentage}`;
                //             input.value = res;
            }
            else {
         console.log("error");

            }
        }else{
            let data = await response.json();        
            let errorinput = data.error;
            const res  = `${errorinput}`;
            input.value = res; }
  }
     catch(error){
        console.log(error);
}loader.style.display = "none";}

</script>

<script>
    async function getAnswers() {

    let selected = document.querySelector("select").value;
    if(selected == "DPR") {
      const text = document.getElementById("txt").value;
      let gen_res = document.getElementById('result')
      let resultCard = document.getElementById('result-card');
      if (text.trim() === '') {
      const res = "Please write your text.";
      return;
  }
  try{
      let response = await fetch('http://127.0.0.1:5678/predict', {
          method: 'POST',
          body: JSON.stringify({ "texts": text }),
          headers: { 'Content-Type': 'application/json' }
      })
      if (response.status === 200) {
          let data = await response.json();
          let res="";
          console.log(data);

          if (data ) {
                for (let index = 0; index < data.length; index++) {
                    const element = data[index];
                    console.log(element);

            const cardsHtml = data.map(item => `
              <div class="card">
                <div class="card-body">
                  
                  <h4 class="card-text">عنوان الفتوى : ${item.title}</h4>
                  <p class="card-text">${item.details}</p>
				  <h6 class="card-text">الإجابة المختصرة :${item.summary}</h6>
                  <h5 class="card-text">الدقة : ${item.score}</h5>
                </div>
              </div>
            `).join('');


resultCard.innerHTML = cardsHtml;
            }
            console.log({res});}}


    } catch(error){
        console.log(error);
    }
    }

  else if(selected == "Top2vec"){
    const text = document.getElementById("txt").value;
        let resultCard = document.getElementById('result-card');
        if (text.trim() === '') {
        const res = "Please write your text.";
        return;
    }
    try{
		console.log("wait respose")
        let response = await fetch('https://topic2vec.infostrategic.com/query', {
            method: 'POST',
            body: JSON.stringify({ "texts": text }),
            headers: { 'Content-Type': 'application/json' }
        })
        if (response.status === 200) {
            let data = await response.json();
			console.log(data)
            let res="";
            console.log(data);

            if (data ) {
                for (let index = 0; index < data.length; index++) {
                    const element = data[index];
                    console.log(element);

            const cardsHtml = data.map(item => `
              <div class="card">
                <div class="card-body">
                  
                  <h4 class="card-text">${item.title}</h4>
				  <h6 class="card-text">${item.summary}</h6>
                  <p class="card-text">${item.details}</p>
                  <p class="card-text">Score: ${item.score}</p>
                </div>
              </div>
            `).join('');


resultCard.innerHTML = cardsHtml;
            }
            console.log({res});}}


    } catch(error){
        console.log(error);
    }}


    else if(selected == "Doc2vec"){
    const text = document.getElementById("txt").value;
        let resultCard = document.getElementById('result-card');
        if (text.trim() === '') {
        const res = "Please write your text.";
        return;
    }
    try{
		console.log("wait respose")
        let response = await fetch('http://127.0.0.1:5678/predict', {
            method: 'POST',
            body: JSON.stringify({ "texts": text }),
            headers: { 'Content-Type': 'application/json' }
        })
        if (response.status === 200) {
            let data = await response.json();
			console.log(data)
            let res="";
            console.log(data);

            if (data ) {
                for (let index = 0; index < data.length; index++) {
                    const element = data[index];
                    console.log(element);

            const cardsHtml = data.map(item => `
              <div class="card">
                <div class="card-body">
                  
                  <h4 class="card-text">${item.title}</h4>
				  <h6 class="card-text">${item.summary}</h6>
                  <p class="card-text">${item.details}</p>
                  <p class="card-text">Score: ${item.score}</p>
                </div>
              </div>
            `).join('');


resultCard.innerHTML = cardsHtml;
            }
            console.log({res});}}


    } catch(error){
        console.log(error);
    }}
    loader.style.display = "none";
  }

  </script>

</body>
</html>
